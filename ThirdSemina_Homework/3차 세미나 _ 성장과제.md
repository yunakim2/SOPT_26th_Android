# 3ì°¨ ì„¸ë¯¸ë‚˜ _ ì„±ì¥ê³¼ì œ

ì¹´ì¹´ì˜¤ OPEN API ë¥¼ ì´ìš©í•´ ì±… ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°

[ğŸ“Œapi ê´€ë ¨ ë¬¸ì„œ](https://developers.kakao.com/docs/latest/ko/daum-search/dev-guide#search-book)

<br>

<br>

## ğŸ‘©ğŸ»â€ğŸ’»**ì™„ì„±í™”ë©´**ğŸ‘©ğŸ»â€ğŸ’»

<br>

<img src = "https://user-images.githubusercontent.com/45454585/81910226-9dd25980-9606-11ea-869d-6e3ac7fb3c29.gif" alt ="booklist" width="40%">



## ğŸ‘©ğŸ»â€ğŸ’»**êµ¬í˜„ë°©ì‹**ğŸ‘©ğŸ»â€ğŸ’»

### âœ… **Gradle ë° manifests ì¶”ê°€í•´ì£¼ê¸°**

âœ”ï¸ Gradle

~~~apl
	 implementation 'androidx.recyclerview:recyclerview:1.1.0'
    //ì´ë¯¸ì§€ ë¡œë”© ë¼ì´ë¸ŒëŸ¬ë¦¬ : glide
    implementation "com.github.bumptech.glide:glide:4.10.0"
    kapt "com.github.bumptech.glide:compiler:4.10.0"
    //Retrofit ë¼ì´ë¸ŒëŸ¬ë¦¬ : https://github.com/square/retrofit
    implementation 'com.squareup.retrofit2:retrofit:2.6.2'
    //Retrofit ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‘ë‹µìœ¼ë¡œ ê°€ì§œ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ìœ„í•´
    implementation 'com.squareup.retrofit2:retrofit-mock:2.6.2'
    //ê°ì²´ ì‹œë¦¬ì–¼ë¼ì´ì¦ˆë¥¼ ìœ„í•œ Gson ë¼ì´ë¸ŒëŸ¬ë¦¬ : https://github.com/google/gson
    implementation 'com.google.code.gson:gson:2.8.6'
    //Retrofit ì—ì„œ Gson ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
    implementation 'com.squareup.retrofit2:converter-gson:2.6.2'
~~~

<br>

âœ”ï¸ AndroidManifest.xml

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.a3_semina_assignment_1">

    <uses-permission android:name="android.permission.INTERNET" />

    <application
        android:usesCleartextTraffic="true"
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/AppTheme">
        <activity android:name=".MainActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>
~~~

<br>

<br>

---

### âœ…activity_main.xml & item_book.xml 

âœ”ï¸drawable - edit_style.xml

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android" android:shape="rectangle">
        <corners android:radius="10dp"/>
        <stroke android:color="@color/colorPrimary" android:width="2dp"/>
        <padding android:bottom="10dp"
            android:left="10dp"
            android:right="10dp"
            android:top="10dp"/>
</shape>
~~~

<br>

âœ”ï¸ activity_main.xml

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:layout_margin="30dp"
    tools:context=".MainActivity">

    <EditText
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:id="@+id/edit_book"
        android:hint="ì›í•˜ëŠ” ì±…ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
        android:background="@drawable/edit_style"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"/>

    <androidx.recyclerview.widget.RecyclerView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:id="@+id/rv_book"
        android:layout_marginTop="10dp"
        tools:listitem="@layout/item_book"
        app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager"
        android:orientation="vertical"
        app:layout_constraintTop_toBottomOf="@id/edit_book"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"/>



</androidx.constraintlayout.widget.ConstraintLayout>
~~~

<br>

âœ”ï¸item_book.xml(ë¦¬ì‚¬ì´í´ëŸ¬ë·° ì•„ì´í…œ)

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="10dp"
    android:background="@drawable/edit_style"
    xmlns:app="http://schemas.android.com/apk/res-auto">

    <androidx.constraintlayout.widget.Guideline
        android:id="@+id/guideline2"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        app:layout_constraintGuide_begin="130dp" />
    <androidx.constraintlayout.widget.Guideline
        android:id="@+id/guideline3"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        app:layout_constraintGuide_begin="380dp" />

    <ImageView
        android:layout_width="100dp"
        android:layout_height="150dp"
        android:id="@+id/img_book_item"
        android:scaleType="centerCrop"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/tv_title_item"
        android:text="ì±…ì œëª©"
        android:textStyle="bold"
        android:textSize="15sp"
        android:textColor="#000000"
        android:layout_marginLeft="10dp"
        app:layout_constraintLeft_toRightOf="@id/img_book_item"
        app:layout_constraintTop_toTopOf="parent"/>
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="ì±…ë‚´ìš©"
        android:textColor="#000000"
        android:layout_marginTop="10dp"
        android:textSize="10sp"
        android:maxLines="5"
        android:ellipsize="end"
        android:id="@+id/tv_subtitle_item"
        app:layout_constraintTop_toBottomOf="@id/tv_title_item"
        app:layout_constraintLeft_toRightOf="@id/guideline2"
        app:layout_constraintRight_toRightOf="@id/guideline3"/>
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/tv_author_item"
        android:textSize="10sp"
        android:layout_marginLeft="10dp"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toRightOf="@id/img_book_item"
        android:textColor="#000000"
        android:textStyle="bold"
        android:text="ì‘ê°€"/>
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/tv_price_item"
        android:textSize="10sp"
        android:textStyle="bold"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toRightOf="@id/tv_author_item"
        android:textColor="#000000"
        android:text="ê°€ê²©"
        android:layout_marginLeft="10dp"/>


</androidx.constraintlayout.widget.ConstraintLayout>
~~~

<br>

<br>

---

### âœ… Data class êµ¬ì„±

â€¼ï¸ ì¹´ì¹´ì˜¤ ì±… ê²€ìƒ‰ api **response**ë¥¼ ë³´ê³  ë™ì¼í•˜ê²Œ ì‘ì„±í•œë‹¤.

<br>

<img width="500" alt="data" src="https://user-images.githubusercontent.com/45454585/82023317-0eda4580-96c9-11ea-8829-482d657c582a.png">

<br>

âœ”ï¸ responseBookData.kt

 â€¼ï¸ Data class ì‘ì„±ì‹œ ì›í•˜ëŠ” dataì— ê´€í•œ ê²ƒë§Œ ëª…ì‹œí•´ì¤˜ë„ ìƒê´€ì—†ìŒ! 

ë‹¨, responseì™€ ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ ëª…ì‹œí•´ì¤˜ì•¼í•¨!

```kotlin
data class responseBookData(
    val metas : List<metasData>,
    val documents : List<DocumentsData>
)

data class metasData(
    val total_count : Int,
    val pageable_count : Int,
    val is_end : Boolean
)
data class DocumentsData(
    val title : String,
    val contents : String,
    val url : String,
    val isbn : String,
    val authors : Array<String>,
    val publisher : String,
    val translators : Array<String>,
    val price : Integer,
    val sale_price :Integer,
    val thumbnail : String,
    val status : String

)
```

<br>

---

### âœ… RecyclerView - ViewHolder & Adapter 

ìœ„ì—ì„œ ë§Œë“  Dataë¥¼ ì´ìš©í•˜ì—¬ ViewHolderì—ì„œ item_ id ì™€ Data ì—°ê²°í•´ì£¼ê¸°

âœ”ï¸ RecyclerViewHolder.kt

â€¼ï¸ ìš°ë¦¬ëŠ” Dataë“¤ ì¤‘ **DocumentsData** ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ *Data : DocumentsData* ë¡œ ì‘ì„±í•´ì£¼ê¸°

~~~kotlin
package com.example.a3_semina_assignment

import android.view.View
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.example.a3_semina_assignment_1.DocumentsData
import com.example.a3_semina_assignment_1.R

class RecyclerViewHolder(itemView : View) : RecyclerView.ViewHolder(itemView) {
    val img = itemView.findViewById<ImageView>(R.id.img_book_item)
    val tv_title = itemView.findViewById<TextView>(R.id.tv_title_item)
    val tv_subtitle = itemView.findViewById<TextView>(R.id.tv_subtitle_item)
    val tv_author = itemView.findViewById<TextView>(R.id.tv_author_item)
    val tv_price = itemView.findViewById<TextView>(R.id.tv_price_item)
    fun bind(Data: DocumentsData)
    {
        tv_title.text = Data.title
        tv_subtitle.text = Data.contents
        tv_author.text = "ì €ì : "+Data.authors[0]
        tv_price.text = "ì •ê°€ : "+Data.price.toString()+"ì›"
        Glide.with(itemView).load(Data.thumbnail).into(img)
    }
}
~~~

<br>

âœ”ï¸RecyclerViewAdapter.kt

â€¼ï¸ ì„œë²„ ì—°ê²°í›„ ë°›ì€ responseDataë¥¼ ì´ìš©í•˜ì—¬ RecyclerViewë¥¼ êµ¬ì„±í•˜ê¸° ë•Œë¬¸ì— Adapterì— *var datas : List*<DocumentsData> ë¥¼ ì…ë ¥ë°›ì•„ì•¼í•¨!

~~~kotlin
package com.example.a3_semina_assignment

import android.content.Context
import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.recyclerview.widget.RecyclerView
import com.example.a3_semina_assignment_1.DocumentsData
import com.example.a3_semina_assignment_1.R

class RecyclerViewAdapter(private val context: Context,var datas : List<DocumentsData>) : RecyclerView.Adapter<RecyclerViewHolder>() {

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerViewHolder {
        val view = LayoutInflater.from(context).inflate(R.layout.item_book,parent,false)
        return RecyclerViewHolder(view)
    }

    override fun getItemCount(): Int {
        return datas.size
    }

    override fun onBindViewHolder(holder: RecyclerViewHolder, position: Int) {
        holder.bind(datas[position])
    }

}
~~~

<br>

---

### âœ… ì„œë²„ ì—°ê²°

â€¼ï¸ ì—°ê²°í•  url ê³¼ í•„ìš”í•œ header í™•ì¸í•˜ê¸°

<img width="868" alt="server" src="https://user-images.githubusercontent.com/45454585/82024432-be63e780-96ca-11ea-91a6-b71a455de4aa.png">

<br>

âœ”ï¸RequestToServer.kt (object)

â€¼ï¸ baseUrl ë¶€ë¶„ì— ìœ„ì—ì„œ í™•ì¸í•œ **"https:dapi.kaka.com"** ë„£ì–´ì¤€ë‹¤.

~~~kotlin
package com.example.a3_semina_assignment_1

import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

object RequestToServer {
    var retrofit = Retrofit.Builder()
        .baseUrl( "https://dapi.kakao.com") .addConverterFactory(GsonConverterFactory.create()) .build()
    var service: RequestInterface = retrofit.create(RequestInterface::class.java)
}
~~~

<br>

âœ”ï¸ RequsetInterface.kt (interface)

â€¼ï¸ Headerë¡œ **api í† í°** ì„ ë„£ì–´ì£¼ê³  , ê²€ìƒ‰ë˜ì–´ì§„ ì±…ì˜ dataê°€ í•„ìš”í•˜ë¯€ë¡œ Queryë¡œ **bookname** ì„ ë„£ì–´ì¤€ë‹¤.

```kotlin
package com.example.a3_semina_assignment_1

import retrofit2.Call
import retrofit2.http.GET
import retrofit2.http.Header
import retrofit2.http.Query

interface RequestInterface {
    @GET("/v3/search/book" )
    fun requestBook(
        @Header("Authorization")  token : String,
        @Query("query") bookname : String

    ) : Call<responseBookData>


}
```

<br>

---

### âœ… MainActivity.kt ì‘ì„±

âœ”ï¸ init() í•¨ìˆ˜ ì‘ì„±

edit_textì˜ ë¦¬ìŠ¤ë„ˆì¸ **addTextChangedListener** ì„ ì´ìš©í•˜ì—¬ edit_textì˜ ë‚´ìš©ì´ ë³€í• ë•Œë§ˆë‹¤ dataë¥¼ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤.

~~~kotlin
fun init()
    {
        
        edit_book.addTextChangedListener(object : TextWatcher
        {
            override fun afterTextChanged(s: Editable?) {

            }

            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {

            }

            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {

                loadDatas(s.toString())
            }

        })

    }
~~~

<br>

âœ”ï¸ loadDatas() í•¨ìˆ˜ ì‘ì„±

í†µì‹ ì´ ì„±ê³µí•˜ë©´ responseDataë¥¼ ì•„ê¹Œ ë§Œë“  Adapterì— ë„£ì–´ì£¼ê³ , notifyDataSetChanged()ë¥¼ ì´ìš©í•˜ì—¬ ë³€í™”ì‹œì¼œì¤€ë‹¤.

~~~kotlin
fun loadDatas(s: String)
    {

        val token = "KakaoAK 017f3524cd4174d42c4c58e25b386856"
        val requestToServer=RequestToServer
        requestToServer.service.requestBook(token,s)
            .enqueue(
                object : retrofit2.Callback<responseBookData> {
                    override fun onFailure(call: Call<responseBookData>, t: Throwable) {
                        Log.d("í†µì‹ ì‹¤íŒ¨", "${t}")
                    }

                    override fun onResponse(
                        call: Call<responseBookData>,
                        response: Response<responseBookData>
                    ) {
                        if (response.isSuccessful) {
                            Log.d("data", "${response.body()}")

                                    bookAdapter  = RecyclerViewAdapter(applicationContext, response!!.body()!!.documents)
                                    bookAdapter.notifyDataSetChanged()
                                    rv_book.addItemDecoration(VerticalItemDecorator(2))
                                    rv_book.adapter = bookAdapter
                        }

                    }
                }
            )


    }
~~~

<br>

<br>

âœ”ï¸ MainActivity.kt

~~~kotlin
package com.example.a3_semina_assignment_1

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.text.Editable
import android.text.TextWatcher
import android.util.Log
import com.example.a3_semina_assignment.RecyclerViewAdapter
import com.example.sopt_semina_assignment.util.VerticalItemDecorator
import kotlinx.android.synthetic.main.activity_main.*
import retrofit2.Call
import retrofit2.Response

class MainActivity : AppCompatActivity() {

    lateinit var bookAdapter: RecyclerViewAdapter
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        init()
    }
    fun init()
    {

        edit_book.addTextChangedListener(object : TextWatcher
        {
            override fun afterTextChanged(s: Editable?) {

            }

            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {

            }

            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {

                loadDatas(s.toString())
            }

        })

    }
    fun loadDatas(s: String)
    {

        val token = "KakaoAK 017f3524cd4174d42c4c58e25b386856"
        val requestToServer=RequestToServer
        requestToServer.service.requestBook(token,s)
            .enqueue(
                object : retrofit2.Callback<responseBookData> {
                    override fun onFailure(call: Call<responseBookData>, t: Throwable) {
                        Log.d("í†µì‹ ì‹¤íŒ¨", "${t}")
                    }

                    override fun onResponse(
                        call: Call<responseBookData>,
                        response: Response<responseBookData>
                    ) {
                        if (response.isSuccessful) {
                            Log.d("data", "${response.body()}")

                                    bookAdapter  = RecyclerViewAdapter(applicationContext, response!!.body()!!.documents)
                                    bookAdapter.notifyDataSetChanged()
                                    rv_book.addItemDecoration(VerticalItemDecorator(2))
                                    rv_book.adapter = bookAdapter
                        }

                    }
                }
            )


    }

}

~~~

<br>

<br>