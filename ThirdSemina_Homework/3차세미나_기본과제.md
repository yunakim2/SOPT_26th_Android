# 3ì°¨ ì„¸ë¯¸ë‚˜ _ ê¸°ë³¸ê³¼ì œ1 & 2

ğŸ“Œ **ë¡œê·¸ì¸ API ë¬¸ì„œë¥¼ ì´ìš©í•˜ì—¬ íšŒì›ê°€ì…, ë¡œê·¸ì¸ í†µì‹ í•˜ê¸°**

retrofit2ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ í†µì‹ í•˜ê¸°

ğŸ“Œ **1,2,3ì°¨ ì„¸ë¯¸ë‚˜ ê³¼ì œ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¡œ ë§Œë“¤ê¸° **

íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ íŒŒì¼ ê³„ì¸µí™” ì‹œí‚¤ê¸°

<br>

<br>

## ğŸ‘©ğŸ»â€ğŸ’»**ì™„ì„±í™”ë©´**ğŸ‘©ğŸ»â€ğŸ’»

<br>

###  âœ… íšŒì›ê°€ì… 

<p align="center"><img height="500px" alt="Login" src="https://user-images.githubusercontent.com/45454585/82029646-43063400-96d2-11ea-83e9-2d2687151995.gif"></p>

<br>

### âœ… ë¡œê·¸ì•„ì›ƒ ë° ë¡œê·¸ì¸

<p align="center"><img height="500px" alt="Login" src="https://user-images.githubusercontent.com/45454585/82029646-43063400-96d2-11ea-83e9-2d2687151995.gif"></p>

<br>

## ğŸ‘©ğŸ»â€ğŸ’»**êµ¬í˜„ë°©ì‹**ğŸ‘©ğŸ»â€ğŸ’»

### âœ… ë¡œê·¸ì¸ ì„œë²„ í†µì‹ 

â€¼ï¸ í†µì‹ í•˜ê¸° ì „ **retrofit2** ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ Gradleì— ì¶”ê°€í•´ì¤€ë‹¤.

~~~kotlin
  //Retrofit ë¼ì´ë¸ŒëŸ¬ë¦¬ : https://github.com/square/retrofit
    implementation 'com.squareup.retrofit2:retrofit:2.6.2'
    //Retrofit ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‘ë‹µìœ¼ë¡œ ê°€ì§œ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ìœ„í•´
     implementation 'com.squareup.retrofit2:retrofit-mock:2.6.2'
    //ê°ì²´ ì‹œë¦¬ì–¼ë¼ì´ì¦ˆë¥¼ ìœ„í•œ Gson ë¼ì´ë¸ŒëŸ¬ë¦¬ : https://github.com/google/gson
    implementation 'com.google.code.gson:gson:2.8.6'
    //Retrofit ì—ì„œ Gson ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
     implementation 'com.squareup.retrofit2:converter-gson:2.6.2'
~~~

<br>

1ï¸âƒ£ **ë¡œê·¸ì¸ API ë¬¸ì„œë¥¼ ë³´ê³  Requestì™€ Response Data í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.**

[ë¡œê·¸ì¸ api ë¬¸ì„œ](https://github.com/gngsn/26th_SERVER/wiki/%E2%9C%94%EF%B8%8F-%EB%A1%9C%EA%B7%B8%EC%9D%B8)

<br>

> â¡ï¸ Request 
>
> ~~~json
> {
>   "id": "gngsn",
>   "password": "qwerty"
> }
> ~~~
>
> - id : ì‚¬ìš©ì ì•„ì´ë””
> - password : ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸
>
> <br>
>
> â¡ï¸ Response
>
> ~~~json
> {
>     "status": 200,
>     "success": true,
>     "message": "ë¡œê·¸ì¸ ì„±ê³µ",
>     "data": {
>         "jwt": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZHgiOjEsIm5hbWUiOiJnbmdzbiIsImlhdCI6MTU4ODU5NjEwOH0.ZvAXsth9RgtwvJRXdjuO3XC6A7uyeFNefhNxi2ok6R4"
>     }
> }
> ~~~
>

<br>

âœ”ï¸ RequestLogin.kt (dataclass)

~~~kotlin
package com.example.sopt_semina_assignment.data

data class RequestLogin(
    val id : String,
    val password : String
)
~~~

<br>

âœ”ï¸ ResponseLogin.kt (dataclass)

â€¼ï¸ @SerializedNameì„ ì´ìš©í•´ ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ë³€ê²½ì‹œì¼œì¤€ë‹¤.

```kotlin
package com.example.sopt_semina_assignment.data

import com.google.gson.annotations.SerializedName

data class ResponseLogin (
    val status : Int,
    val success : Boolean,
    val message : String,
    @SerializedName("data")
    val responseData : SomeData?
)
data class  SomeData(
    val jwt : String
)
```

<br>

2ï¸âƒ£ **ì—°ê²°í•  ì„œë²„ì˜ ì£¼ì†Œë¥¼ í™•ì¸í•˜ì—¬ RequestToServerë¥¼ ì‘ì„±í•´ì¤€ë‹¤.**

ì£¼ì†Œ : *"http://13.209.144.115:3333"*

âœ”ï¸ RequestToServer.kt (object)

~~~kotlin
package com.example.sopt_semina_assignment.network

import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

object RequestToServer {
    var retrofit = Retrofit.Builder()
        .baseUrl("http://13.209.144.115:3333") .addConverterFactory(GsonConverterFactory.create()) .build()
    var service: RequestInterface = retrofit.create(RequestInterface::class.java) }
~~~

<br>

3ï¸âƒ£ **RequestInterface ì‘ì„±í•˜ê¸°** 

âœ”ï¸ RequestInterface.kt (interface)

â€¼ï¸ POST ë°©ì‹ìœ¼ë¡œ Bodyë¥¼ ì´ìš©í•˜ì—¬ RequestLogin Dataë¥¼ ë„˜ê²¨ì£¼ê³ , ê²°ê³¼ë¡œ ë„˜ì–´ì˜¨ DataëŠ” ResponseLogin Dataì— ë‹´ê²¨ì§„ë‹¤.

~~~kotlin
package com.example.sopt_semina_assignment.network


import com.example.sopt_semina_assignment.data.RequestLogin
import com.example.sopt_semina_assignment.data.ResponseLogin
import com.example.sopt_semina_assignment.data.ResponseRegister
import retrofit2.Call
import retrofit2.http.Body
import retrofit2.http.Field
import retrofit2.http.FormUrlEncoded
import retrofit2.http.POST

interface RequestInterface {
    @POST("/user/signin")
    fun requestLogin(@Body body: RequestLogin) : Call<ResponseLogin>
}
~~~

<br>

4ï¸âƒ£ **LoginActivity.kt ì—ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì„œë²„ì™€ ì—°ê²°í•´ì£¼ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì¤€ë‹¤.**

ë¡œê·¸ì¸ ì„±ê³µì‹œ MainActivityë¡œ intentë¥¼ ë„˜ê²¨ì£¼ê³ , í•´ë‹¹ id ì™€ pwë¥¼ SharedPreferences ì— ì €ì¥í•œë‹¤.

~~~kotlin
requestToServer.service.requestLogin(
                    RequestLogin(id = edit_id.text.toString(),
                    password = edit_pw.text.toString())
                ).enqueue(object : Callback<ResponseLogin>
                {
                    override fun onFailure(call: Call<ResponseLogin>, t: Throwable) {
                     Log.d("ë¡œê·¸ì¸ í†µì‹ ì‹¤íŒ¨", "${t}")
                    }

                    override fun onResponse(
                        call: Call<ResponseLogin>,
                        response: Response<ResponseLogin>
                    ) {
                        if(response.isSuccessful)
                        {
                            if(response.body()!!.success)
                            {
                                Log.d("ë¡œê·¸ì¸ ì„±ê³µ", "id : ${edit_id.text.toString()}, pw : ${edit_pw.text.toString()}")
                                Toast.makeText(applicationContext, "ë¡œê·¸ì¸ ì„±ê³µ", Toast.LENGTH_SHORT).show()
                                editor.putString("id",edit_id.text.toString())
                                editor.putString("pw",edit_pw.text.toString())
                                editor.commit()
                                val intent = Intent(applicationContext, MainActivity::class.java)
                                startActivityForResult(intent,CODE)
                            }
                            else
                            {
                                Toast.makeText(applicationContext, "ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”", Toast.LENGTH_SHORT).show();

                            }
                        }
                    }

                })
~~~

<br>

----

### âœ… íšŒì›ê°€ì… ì„œë²„ í†µì‹ 

â€¼ï¸ **ë¡œê·¸ì¸ ì„œë²„ í†µì‹ ê³¼ ë§¤ìš° ìœ ì‚¬í•˜ë¯€ë¡œ ë°©ë²•ì€ ìƒëµ**

âœ”ï¸ ResponseRegister.kt (dataclass)

```kotlin
data class ResponseRegister(
    val status : Int,
    val success : Boolean,
    val message : String
)
```

<br>

âœ… RequestToServer.kt (object) ëŠ” ë¡œê·¸ì¸ê³¼ ë™ì¼í•œ ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì™€ í†µì‹ í•˜ë¯€ë¡œ, **ìƒëµê°€ëŠ¥**

<br>

âœ”ï¸RequestInterface.kt (interface) 

â€¼ï¸ ì„œë²„ì— ì „ë‹¬í•´ì¤˜ì•¼ í•˜ëŠ” ì •ë³´ë“¤ì„ *@Body* ë¥¼ ì´ìš©í•˜ì—¬ Dataí™” ì‹œì¼œ ì „ë‹¬í•´ì¤„ ìˆ˜ë„ ìˆì§€ë§Œ, ê·¸ëƒ¥ *@Field* ë¥¼ í†µí•´ ì „ë‹¬í•´ì£¼ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤!

~~~kotlin
package com.example.sopt_semina_assignment.network


import com.example.sopt_semina_assignment.data.RequestLogin
import com.example.sopt_semina_assignment.data.ResponseLogin
import com.example.sopt_semina_assignment.data.ResponseRegister
import retrofit2.Call
import retrofit2.http.Body
import retrofit2.http.Field
import retrofit2.http.FormUrlEncoded
import retrofit2.http.POST

interface RequestInterface {
    @POST("/user/signin")
    fun requestLogin(@Body body: RequestLogin) : Call<ResponseLogin>

    @FormUrlEncoded
    @POST("/user/signup")
    fun requestRegister(
        @Field("id") id:String,
        @Field("password") pw:String,
        @Field("name") name : String,
        @Field("email") email : String,
        @Field("phone") phone:String
    ) : Call<ResponseRegister>
}
~~~

<br>

âœ”ï¸ RegisterActivity.kt 

ëª¨ë“  ì •ë³´ë“¤ì´ ë‹¤ ì…ë ¥ë˜ì–´ì§€ê³ , pwì™€ pwcheckê°€ ê°™ìœ¼ë©´ ì„œë²„ì™€ ì—°ê²°í•˜ëŠ” ì½”ë“œ ì‘ì„±

idê°€ ë²Œì¨ ì¡´ì¬í•œë‹¤ë©´ **status **ê°€ **200** ìœ¼ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— ì¤‘ë³µë˜ëŠ” idê°€ ìˆë‹¤ê³  Toast ë„ì–´ì¤Œ

~~~kotlin
val requestToServer= RequestToServer
val id = edit_id_register.text.toString()
val pw = edit_pw_register.text.toString()
val name = edit_name_register.text.toString()
val phone = edit_phone_register.text.toString()
val email = edit_email_register.text.toString() 

requestToServer.service.requestRegister(id, pw, name, email, phone)
                .enqueue(
                    object : Callback<ResponseRegister> {
                        override fun onFailure(call: Call<ResponseRegister>, t: Throwable) {
                            Log.d("í†µì‹ ì‹¤íŒ¨", "${t}")
                        }

                        override fun onResponse(
                            call: Call<ResponseRegister>,
                            response: Response<ResponseRegister>
                        ) {

                            if (response.isSuccessful) {

                                if (response.body()!!.success) {
                                    Log.d("íšŒì›ê°€ì… ì„±ê³µ", "id : ${id}, pw : ${pw}")
                                    Toast.makeText(
                                        applicationContext,
                                        "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
                                        Toast.LENGTH_SHORT
                                    ).show()
                                    val intent =
                                        Intent(applicationContext, LoginActivity::class.java)
                                    editor.putString("id", edit_id_register.text.toString())
                                    editor.putString("pw", edit_pw_register.text.toString())
                                    editor.commit()
                                    intent.putExtra("id", edit_id_register.text.toString())
                                    intent.putExtra("pw", edit_pw_register.text.toString())
                                    startActivityForResult(intent, CODE)
                                }
                                else
                                {
                                    if (response.body()!!.status == 200) {
                                        Toast.makeText(
                                            applicationContext,
                                            "${response.body()!!.message}",
                                            Toast.LENGTH_SHORT
                                        ).show()
                                    }
                                }
                            }
                        }
                    }
                )
~~~

<br>

---

### âœ… MypageFragment.kt ì—ì„œ id, pw í™•ì¸í•˜ê³  ë¡œê·¸ì•„ì›ƒ í•˜ê¸°

1ï¸âƒ£ fragment_mypage.xml ì½”ë“œ ì‘ì„±í•´ì£¼ê¸°

<br>

<img width="452" alt="mypage" src="https://user-images.githubusercontent.com/45454585/82028585-ccb50200-96d0-11ea-8dbd-09b45bbeff5c.png">

<br>

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    tools:context=".ui.fragment.MypageFragment">

    <!-- TODO: Update blank fragment layout -->
   <androidx.constraintlayout.widget.ConstraintLayout
       android:layout_width="match_parent"
       android:layout_height="match_parent"
       android:padding="30dp">

       <ImageView
           android:layout_width="match_parent"
           android:layout_height="100dp"
           android:scaleType="centerCrop"
           android:layout_marginTop="100dp"
           android:src="@mipmap/sopt"
           android:id="@+id/img_sopt"
           app:layout_constraintTop_toTopOf="parent"
           app:layout_constraintLeft_toLeftOf="parent"
           app:layout_constraintRight_toRightOf="parent"/>


       <LinearLayout
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:id="@+id/ll_id"
           android:layout_marginTop="100dp"
           app:layout_constraintTop_toBottomOf="@id/img_sopt"
           app:layout_constraintLeft_toLeftOf="parent"
           app:layout_constraintRight_toRightOf="parent">
       <TextView
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="ID : "
           android:textColor="@color/colorGray"
           android:textSize="20sp"/>

       <TextView
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:id="@+id/tv_id_mypage"
           android:text="id"
           android:textColor="@color/colorGray"
           android:textStyle="bold"
           android:textSize="20sp"/>
       </LinearLayout>

       <LinearLayout
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:id="@+id/ll_pw"
           app:layout_constraintTop_toBottomOf="@id/ll_id"
           app:layout_constraintRight_toRightOf="parent"
           app:layout_constraintLeft_toLeftOf="parent">
       <TextView
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="Password : "
           android:textColor="@color/colorGray"
           android:textSize="20sp"/>



       <TextView
           android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:id="@+id/tv_pw_mypage"
           android:text="pw"
           android:textColor="@color/colorGray"
           android:textStyle="bold"
           android:textSize="20sp"/>
       </LinearLayout>

       <Button
           android:layout_width="match_parent"
           android:layout_height="wrap_content"
           android:id="@+id/btn_logout_mypage"
           app:layout_constraintTop_toBottomOf="@id/ll_pw"
           app:layout_constraintLeft_toLeftOf="parent"
           app:layout_constraintRight_toRightOf="parent"
           android:text="ë¡œê·¸ì•„ì›ƒ"
           android:layout_marginTop="30dp"
           android:textColor="@color/colorWhite"
           android:background="@drawable/btn_style1"

           />



   </androidx.constraintlayout.widget.ConstraintLayout>
</FrameLayout>
~~~

<br>

2ï¸âƒ£ MypageFragment.kt *SharedPreferences* ì— ì €ì¥ ë˜ì–´ì§„ id, pwì„ ì´ìš©í•˜ì—¬ tv_id ì™€ tv_pw ì˜ text ë³€ê²½

ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ LoginActivityë¡œ intent ì „ë‹¬í•˜ê¸° , í•´ë‹¹ Activity(MainActivity) ì¢…ë£Œí•˜ê¸°

<br>

âœ”ï¸ MypageFragment.kt

```kotlin
package com.example.sopt_semina_assignment.ui.fragment

import android.content.Context
import android.content.Intent
import android.content.SharedPreferences
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.fragment.app.Fragment
import androidx.fragment.app.FragmentManager
import com.example.sopt_semina_assignment.R
import com.example.sopt_semina_assignment.ui.LoginActivity
import com.example.sopt_semina_assignment.ui.MainActivity
import kotlinx.android.synthetic.main.fragment_mypage.*

/**
 * A simple [Fragment] subclass.
 */
class MypageFragment : Fragment() {

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.fragment_mypage, container, false)
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        var pref : SharedPreferences = this.activity!!.getSharedPreferences("pref", Context.MODE_PRIVATE)
        val editor : SharedPreferences.Editor = pref.edit()
        if(!pref.getString("id",null).toString().isNullOrBlank())
        {
            val id = pref.getString("id",null).toString()
            val pw = pref.getString("pw",null).toString()
            tv_id_mypage.text = id
            tv_pw_mypage.text = pw

        }
        btn_logout_mypage.setOnClickListener {
            editor.clear()
            editor.commit()
            val intent = Intent(context, LoginActivity::class.java)
            activity!!.finish()
            startActivity(intent)
        }
    }

}
```

<br>

<br>

---

